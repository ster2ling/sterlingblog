<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>Sterling's Blog</title>
        <link rel="icon" type="image/x-icon" href="../favicon.ico"> 
        <link rel="stylesheet" href="../2.0 stylejourn.css">
    </head>
    <body>
      <div id="starfield-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -100;">
        <canvas id="starfield" style="width: 100%; height: 100%;"></canvas>
      </div>
      <script src="../js/starfield.js"></script>
    
      <div id="container" style="position: relative; z-index: 1; background-color: transparent;">

        <div class="navbar-window">
          <div id="navbar">
            <a href="../index.html" class="nav-button">
              <img src="../images/home window icon.png" alt="Home">
              <span>Home</span>
            </a>
            <a href="../about/index.html" class="nav-button">
              <img src="../images/about window icon.png" alt="About">
              <span>About</span>
            </a>
            <a href="index.html" class="nav-button">
              <img src="../images/writing window icon.png" alt="Blog">
              <span>Blog</span>
            </a>
            <a href="../quotebook/index.html" class="nav-button">
              <img src="../images/stag city window icon 2.png" alt="Quotebook">
              <span>Quotebook</span>
            </a>
            <a href="../other/index.html" class="nav-button">
              <img src="../images/other window icon.png" alt="Other">
              <span>Other</span>
            </a>
            <a href="../basement/index.html" class="nav-button"> 
              <img src="../images/basement window icon.png" alt="Basement">
              <span>Basement</span>
            </a>
          </div>
        </div>
    
<div id="sidebar">
    <div class="side" id="deco">
        <div class="table" id="date-list">
        <details open style="font-size: larger;">
            <summary style="font-weight: bold; color: blue;">2025</summary>
            <!-- Dates will be populated dynamically -->
        </details>
    </div>
    </div>
    <div style="height: 550px;" id="deco"></div>
</div>
        

        <div id="journ">
            <div class="areaJournal">
                <div class="subjectJournal" id="blog-content">
                    <!-- Blog posts will be populated dynamically -->
                </div>
            </div>
        </div>

        <div id="forum-section">
            <div class="window">
                <div class="title-bar">
                    <div class="title-bar-text">Forum</div>
                    <div class="title-bar-controls">
                        <button aria-label="Minimize"></button>
                        <button aria-label="Maximize"></button>
                        <button aria-label="Close"></button>
                    </div>
                </div>
                <div class="window-body">
                    <div class="forum-content" id="forum-content">
                        <div class="forum-post">
                            <div class="post-header">
                                <span class="post-author">Anonymous</span>
                                <span class="post-time">Just now</span>
                            </div>
                            <div class="post-message">Welcome to the forum! Feel free to discuss anything here.</div>
                        </div>
                    </div>
                    <div class="forum-input">
                        <div class="field-row">
                            <input type="text" placeholder="Your name..." id="forum-name-input" style="width: 120px;">
                            <input type="text" placeholder="Your message..." id="forum-message-input">
                            <button type="button" id="forum-send-btn">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        

        
<footer id="footer">
    <div class="window">
      <div class="window-body">
          <div class="status-bar">
            <p class="status-bar-field"><a href="../sitemap.html">sitemap</a></p>
            <p class="status-bar-field">This website is brought to you by: boredom.</p>
            <p class="status-bar-field">Since Oct 27th, 2025</p>
          </div>
      </div>
    </div>
  </footer>
      
              
  </div>

  <script>
    // Forum functionality
    document.addEventListener('DOMContentLoaded', function() {
      const nameInput = document.getElementById('forum-name-input');
      const messageInput = document.getElementById('forum-message-input');
      const sendBtn = document.getElementById('forum-send-btn');
      const forumContent = document.getElementById('forum-content');

      let lastPostCount = 0;
      
      // Load existing forum posts
      async function loadForumPosts() {
        try {
          const response = await fetch('/api/forum');
          if (response.ok) {
            const posts = await response.json();
            
            // Only update if there are new posts
            if (posts.length !== lastPostCount) {
              forumContent.innerHTML = '';
              posts.forEach(post => {
                addMessageToDOM(post.message, post.author, post.date, post.time);
              });
              lastPostCount = posts.length;
            }
          }
        } catch (error) {
          console.error('Error loading forum posts:', error);
          // Fallback to localStorage
          const posts = JSON.parse(localStorage.getItem('forumPosts') || '[]');
          if (posts.length !== lastPostCount) {
            forumContent.innerHTML = '';
            posts.forEach(post => {
              addMessageToDOM(post.message, post.author, post.date, post.time);
            });
            lastPostCount = posts.length;
          }
        }
      }

      function addMessageToDOM(message, author = 'Anonymous', date = null, time = null) {
        const postDiv = document.createElement('div');
        postDiv.className = 'forum-post';
        
        if (!date || !time) {
          const now = new Date();
          date = now.toLocaleDateString([], {month: '2-digit', day: '2-digit', year: '2-digit'});
          time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        const fullTimestamp = `${date} ${time}`;
        
        postDiv.innerHTML = `
          <div class="post-header">
            <span class="post-author">${author}</span>
            <span class="post-time">${fullTimestamp}</span>
          </div>
          <div class="post-message">${message}</div>
        `;
        
        forumContent.appendChild(postDiv);
        forumContent.scrollTop = forumContent.scrollHeight;
      }

      async function sendMessage() {
        const message = messageInput.value.trim();
        const author = nameInput.value.trim() || 'Anonymous';
        
        if (message) {
          // Add message immediately for instant feedback
          const now = new Date();
          const date = now.toLocaleDateString([], {month: '2-digit', day: '2-digit', year: '2-digit'});
          const time = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
          
          addMessageToDOM(message, author, date, time);
          messageInput.value = '';
          lastPostCount++; // Update counter
          
          // Then save to server in background
          try {
            const response = await fetch('/api/forum', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ message, author })
            });
            
            if (!response.ok) {
              throw new Error('Failed to save to server');
            }
          } catch (error) {
            console.error('Error saving to server:', error);
            // Fallback to localStorage
            const posts = JSON.parse(localStorage.getItem('forumPosts') || '[]');
            const newPost = { message, author, date, time, timestamp: now.toISOString() };
            posts.push(newPost);
            localStorage.setItem('forumPosts', JSON.stringify(posts));
          }
        }
      }

      // Load posts on page load
      loadForumPosts();

      // Poll for new messages every 2 seconds
      setInterval(loadForumPosts, 2000);

      sendBtn.addEventListener('click', sendMessage);
      
      messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
    });
  </script>
</body>
</html>