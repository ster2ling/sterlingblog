<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum - Sterling's Site</title>
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <link rel="apple-touch-icon" href="../favicon.svg"> 
    <link rel="stylesheet" href="../style.css">

    <script>
      window.BUILD_TIME = 1761595031501;
      window.VERCEL_BUILD_TIME = 1761595031501;
    </script>

    <style>
        .forum-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .forum-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .forum-title {
            font-family: 'ADDSBP', 'ADDSBP', sans-serif;
            font-size: 32px;
            font-weight: bold;
            color: #000080;
            text-decoration: underline;
            margin-bottom: 10px;
        }

        .forum-subtitle {
            font-family: 'Pixel Operator', monospace;
            font-size: 14px;
            color: #666;
        }

        .forum-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-family: 'Pixel Operator', monospace;
            font-size: 12px;
            color: #666;
        }

        .forum-stats div {
            background: linear-gradient(135deg, #c0c0c0 0%, #d0d0d0 50%, #c0c0c0 100%);
            padding: 8px 16px;
            border: 2px outset #c0c0c0;
            border-radius: 3px;
        }

        .new-post-section {
            background: linear-gradient(135deg, #c0c0c0 0%, #d0d0d0 50%, #c0c0c0 100%);
            border: 2px outset #c0c0c0;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .new-post-title {
            font-family: 'Pixel Operator', monospace;
            font-size: 16px;
            font-weight: bold;
            color: #000080;
            margin-bottom: 15px;
            text-decoration: underline;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-family: 'Pixel Operator', monospace;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 2px inset #c0c0c0;
            background: #fff;
            font-family: 'Pixel Operator', monospace;
            font-size: 12px;
            box-sizing: border-box;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .submit-btn {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 8px 16px;
            font-family: 'Pixel Operator', monospace;
            font-size: 12px;
            cursor: pointer;
            color: #000;
        }

        .submit-btn:hover {
            background: #d0d0d0;
            border: 2px inset #c0c0c0;
        }

        .submit-btn:active {
            border: 2px inset #c0c0c0;
        }

        .forum-posts {
            margin-top: 30px;
        }

        .forum-post {
            position: relative;
            margin: 40px auto;
            max-width: 600px;
            transform: rotate(-1deg);
            transition: transform 0.3s ease;
        }

        .forum-post:hover {
            transform: rotate(0deg) scale(1.02);
        }

        .paper-texture {
            background-image: url('../images/paper.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 40px 50px 40px 80px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            min-height: 400px;
            margin: 0 auto;
            max-width: 600px;
        }

        .paper-texture::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 20px;
            background: repeating-linear-gradient(
                to bottom,
                transparent 0px,
                transparent 8px,
                #333 8px,
                #333 10px,
                transparent 10px,
                transparent 18px
            );
            border-radius: 10px 0 0 10px;
        }

        .sticky-note {
            position: absolute;
            top: 20px;
            left: -20px;
            width: 120px;
            height: 140px;
            background-image: url('../images/stickybg.png');
            background-size: cover;
            background-position: center;
            transform: rotate(-5deg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .collector-badge {
            position: absolute;
            top: 20px;
            right: -30px;
            width: 150px;
            height: 60px;
            background: linear-gradient(135deg, #c0c0c0 0%, #a0a0a0 50%, #c0c0c0 100%);
            border: 2px outset #c0c0c0;
            transform: rotate(5deg);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Pixel Operator', monospace;
            font-size: 8px;
            font-weight: bold;
            color: #333;
            text-align: center;
            padding: 5px;
        }

        .collector-badge .top-text {
            font-size: 6px;
            margin-bottom: 2px;
        }

        .collector-badge .main-text {
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .collector-badge .bottom-text {
            font-size: 6px;
        }

        .post-date {
            font-family: 'Pixel Operator', monospace;
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        .post-title {
            font-family: 'ADDSBP', 'ADDSBP', sans-serif;
            font-size: 24px;
            font-weight: bold;
            color: #000080;
            margin-bottom: 15px;
            text-decoration: underline;
        }

        .post-content {
            font-family: 'Pixel Operator', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
        }

        .post-meta {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            font-size: 12px;
            color: #666;
            font-family: 'Pixel Operator', monospace;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-author {
            font-weight: bold;
            color: #000080;
        }

        .post-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: #e0e0e0;
            border: 1px outset #c0c0c0;
            padding: 4px 8px;
            font-family: 'Pixel Operator', monospace;
            font-size: 10px;
            cursor: pointer;
            color: #333;
        }

        .action-btn:hover {
            background: #f0f0f0;
            border: 1px inset #c0c0c0;
        }

        .delete-btn {
            background: #ffcccc;
            color: #cc0000;
        }

        .delete-btn:hover {
            background: #ffdddd;
        }

        .loading {
            text-align: center;
            font-family: 'Pixel Operator', monospace;
            font-size: 12px;
            color: #666;
            margin: 20px 0;
        }

        .error {
            background: #ffcccc;
            border: 2px inset #ff9999;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Pixel Operator', monospace;
            font-size: 12px;
            color: #cc0000;
        }

        .success {
            background: #ccffcc;
            border: 2px inset #99ff99;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Pixel Operator', monospace;
            font-size: 12px;
            color: #006600;
        }

        .admin-controls {
            background: #ffffcc;
            border: 2px inset #ffff99;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Pixel Operator', monospace;
            font-size: 11px;
            color: #666;
        }

        .decorative-cat {
            position: absolute;
            bottom: 50px;
            left: 50px;
            width: 100px;
            height: 80px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 80"><rect x="20" y="30" width="60" height="40" fill="%23ccc" rx="5"/><circle cx="30" cy="25" r="8" fill="%23ccc"/><circle cx="70" cy="25" r="8" fill="%23ccc"/><circle cx="30" cy="25" r="3" fill="%23f00"/><circle cx="70" cy="25" r="3" fill="%23f00"/><rect x="25" y="35" width="50" height="30" fill="%23fff" rx="3"/><text x="50" y="50" text-anchor="middle" font-size="8" fill="%23333">üê±</text></svg>') no-repeat;
            opacity: 0.7;
            z-index: 5;
        }

        .decorative-bust {
            position: absolute;
            bottom: 50px;
            right: 50px;
            width: 80px;
            height: 120px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 120"><rect x="20" y="40" width="40" height="60" fill="%23666" rx="5"/><circle cx="40" cy="30" r="15" fill="%23666"/><rect x="15" y="100" width="50" height="20" fill="%23333" rx="3"/></svg>') no-repeat;
            opacity: 0.6;
            z-index: 5;
        }

        @media (max-width: 768px) {
            .forum-container {
                padding: 10px;
            }
            
            .forum-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .forum-post {
                margin: 20px auto;
                transform: none;
            }
            
            .forum-post:hover {
                transform: scale(1.01);
            }
            
            .post-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .decorative-cat,
            .decorative-bust {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="nav-bar">
            <a href="/" class="nav-button">
                <img src="../images/home window icon.png" alt="Home">
                <span>Home</span>
            </a>
            <a href="/about" class="nav-button">
                <img src="../images/about window icon.png" alt="About">
                <span>About</span>
            </a>
            <a href="/blog" class="nav-button">
                <img src="../images/writing window icon.png" alt="Blog">
                <span>Blog</span>
            </a>
            <a href="/quotebook" class="nav-button">
                <img src="../images/other window icon.png" alt="Quotebook">
                <span>Quotebook</span>
            </a>
            <a href="/forum" class="nav-button active">
                <img src="../images/other window icon.png" alt="Forum">
                <span>Forum</span>
            </a>
            <a href="/basement" class="nav-button"> 
                <img src="../images/basement window icon.png" alt="Basement">
                <span>Basement</span>
            </a>
        </nav>

        <div class="forum-container">
            <!-- Messages -->
            <div id="messages"></div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-left">
                <p class="status-bar-field"><a href="/sitemap">sitemap</a></p>
            </div>
            <div class="footer-center">
                <p class="status-bar-field">This website is brought to you out of boredom.</p>
            </div>
            <div class="footer-right">
                <p class="status-bar-field">Since Oct 27th, 2025</p>
            </div>
        </footer>
    </div>

    <script>
        // Forum functionality
        let posts = [];
        let isAdmin = false;

        // Check if user is admin
        function checkAdminStatus() {
            const adminStatus = localStorage.getItem('adminLoggedIn');
            if (adminStatus === 'true') {
                isAdmin = true;
                document.getElementById('admin-controls').style.display = 'block';
            }
        }

        // Load forum posts
        async function loadPosts() {
            try {
                document.getElementById('loading').style.display = 'block';
                const response = await fetch('/api/forum');
                
                if (response.ok) {
                    posts = await response.json();
                } else {
                    // Fallback to localStorage
                    posts = JSON.parse(localStorage.getItem('forumPosts') || '[]');
                }
                
                displayPosts();
                updateStats();
            } catch (error) {
                console.error('Error loading posts:', error);
                // Fallback to localStorage
                posts = JSON.parse(localStorage.getItem('forumPosts') || '[]');
                displayPosts();
                updateStats();
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Display posts
        function displayPosts() {
            const container = document.getElementById('messages');
            
            // Show just the layout without any text content yet
            container.innerHTML = `
                <div class="forum-post">
                    <div class="sticky-note"></div>
                    <div class="collector-badge">
                        <div class="top-text">SPECIAL</div>
                        <div class="main-text">COLLECTOR'S</div>
                        <div class="bottom-text">EDITION</div>
                    </div>
                    <div class="paper-texture">
                        <!-- Content area ready for text -->
                    </div>
                </div>
            `;
        }

        // Update forum stats
        function updateStats() {
            document.getElementById('post-count').textContent = posts.length;
            
            // Count unique users
            const uniqueUsers = new Set(posts.map(post => post.author || 'Anonymous'));
            document.getElementById('user-count').textContent = uniqueUsers.size;
            
            // Get last activity
            if (posts.length > 0) {
                const lastPost = posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
                document.getElementById('last-post-time').textContent = formatTimeAgo(lastPost.timestamp);
            } else {
                document.getElementById('last-post-time').textContent = 'Never';
            }
        }

        // Format time ago
        function formatTimeAgo(timestamp) {
            const now = new Date();
            const postTime = new Date(timestamp);
            const diffMs = now - postTime;
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            if (diffMinutes < 1) return 'just now';
            if (diffMinutes < 60) return `${diffMinutes}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return postTime.toLocaleDateString();
        }

        // Submit new post
        async function submitPost(event) {
            event.preventDefault();
            
            const author = document.getElementById('author-name').value.trim() || 'Anonymous';
            const title = document.getElementById('post-title').value.trim();
            const content = document.getElementById('post-content').value.trim();
            
            if (!title || !content) {
                alert('Please fill in both title and content!');
                return;
            }
            
            const newPost = {
                id: Date.now().toString(),
                author: author,
                title: title,
                content: content,
                timestamp: new Date().toLocaleString()
            };
            
            try {
                const response = await fetch('/api/forum', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newPost)
                });
                
                if (response.ok) {
                    posts.unshift(newPost);
                    displayPosts();
                    updateStats();
                    
                    // Clear form
                    document.getElementById('new-post-form').reset();
                    
                    // Show success message
                    showMessage('Post submitted successfully!', 'success');
                } else {
                    throw new Error('Failed to submit post');
                }
            } catch (error) {
                console.error('Error submitting post:', error);
                // Fallback to localStorage
                posts.unshift(newPost);
                localStorage.setItem('forumPosts', JSON.stringify(posts));
                displayPosts();
                updateStats();
                document.getElementById('new-post-form').reset();
                showMessage('Post saved locally (server unavailable)', 'success');
            }
        }

        // Delete post (admin only)
        async function deletePost(postId) {
            if (!isAdmin) return;
            
            if (!confirm('Are you sure you want to delete this post?')) return;
            
            try {
                const response = await fetch(`/api/forum/${postId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    posts = posts.filter(post => post.id !== postId);
                    displayPosts();
                    updateStats();
                    showMessage('Post deleted successfully!', 'success');
                } else {
                    throw new Error('Failed to delete post');
                }
            } catch (error) {
                console.error('Error deleting post:', error);
                // Fallback to localStorage
                posts = posts.filter(post => post.id !== postId);
                localStorage.setItem('forumPosts', JSON.stringify(posts));
                displayPosts();
                updateStats();
                showMessage('Post deleted locally (server unavailable)', 'success');
            }
        }

        // Clear all posts (admin only)
        async function clearAllPosts() {
            if (!isAdmin) return;
            
            if (!confirm('Are you sure you want to delete ALL posts? This cannot be undone!')) return;
            
            try {
                const response = await fetch('/api/forum', {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    posts = [];
                    displayPosts();
                    updateStats();
                    showMessage('All posts cleared!', 'success');
                } else {
                    throw new Error('Failed to clear posts');
                }
            } catch (error) {
                console.error('Error clearing posts:', error);
                // Fallback to localStorage
                posts = [];
                localStorage.setItem('forumPosts', JSON.stringify(posts));
                displayPosts();
                updateStats();
                showMessage('Posts cleared locally (server unavailable)', 'success');
            }
        }

        // Export posts
        function exportPosts() {
            const dataStr = JSON.stringify(posts, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'forum-posts.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Show message
        function showMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = text;
            
            const container = document.querySelector('.forum-container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Initialize forum
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminStatus();
            loadPosts();
            
            // Set up form submission
            document.getElementById('new-post-form').addEventListener('submit', submitPost);
            
            // Auto-refresh every 30 seconds
            setInterval(loadPosts, 30000);
        });
    </script>
</body>
</html>
